FROM ghcr.io/bioconductor/bioconductor:3.17
RUN sudo apt-get update && sudo apt-get -y install apt-file && sudo apt-get install -y gcc-multilib ; curl -o openbugs.tar.gz https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/2018/04/OpenBUGS-3.2.3.tar.gz ; tar -zxvf openbugs.tar.gz ; rm -rf openbugs.tar.gz; cd OpenBUGS-* ; ./configure ; make ; sudo make install ; cd ../ ; rm -rf OpenBUGS-*; echo isoformic,fgsea | tr ',' '\n' > /tmp/pkglist && cat /tmp/pkglist | xargs -i Rscript -e "if (!require('rspm')) { install.packages('rspm'); rspm::enable(); }; p = BiocManager::install(c('{}'), dependencies = c('Depends', 'Imports', 'LinkingTo', 'Suggests')); if(p %in% rownames(installed.packages())) q(status = 0) else if(strsplit(p, '/')[[1]][2] %in% rownames(installed.packages())) q(status = 0) else q(status = 1)"
RUN sudo apt-get update && sudo apt-get -y install apt-file && sudo apt-get install -y gcc-multilib ; curl -o openbugs.tar.gz https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/2018/04/OpenBUGS-3.2.3.tar.gz ; tar -zxvf openbugs.tar.gz ; rm -rf openbugs.tar.gz; cd OpenBUGS-* ; ./configure ; make ; sudo make install ; cd ../ ; rm -rf OpenBUGS-*; cd /home/rstudio && echo "vignettes/*" | tr ',' '\n' > vignlist && git clone https://github.com/luciorq/isoformic && cp -r isoformic tmpsource && cd tmpsource && curl -o install.sh https://raw.githubusercontent.com/Bioconductor/workshop-contributions/main/.github/scripts/install_missing.sh && cat ../vignlist | xargs -i bash install.sh {} && cd .. && rm -rf vignlist tmpsource/ 
